<!DOCTYPE html>
<html style="width: 100%;">
<!--

== OpenJSCAD.org, Copyright (c) 2016-2017, Licensed under MIT License ==
   in conjunction with other libraries by various authors (see the individual files)

Purpose:
  This application provides an example of how to show JSCAD designs with minimal HTML and CSS.
-->

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>OpenJSCAD.org Logo</title>
  <link rel="stylesheet" href="min.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | soy_simu</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link href="https://fonts.googleapis.com/earlyaccess/sawarabigothic.css" rel="stylesheet" />
  <script src="TemplateData/UnityProgress.js"></script>
  <script src="Build/UnityLoader.js"></script>
  <script>
    let unity_kidou = false;
    let openjscad_kidou = false;
    let openjscad_polygons = new Array();
    function UnityAwake() {
      unity_kidou = true;
      if (unity_kidou && openjscad_kidou) {
        //console.log(openjscad_polygons.length);
        //console.log(openjscad_polygons);
        let polystr = "";
        for (let i = 0; i < openjscad_polygons.length; i++) {
          gameInstance.SendMessage('make_stl', 'pushpolygons', openjscad_polygons[i][0]);
          gameInstance.SendMessage('make_stl', 'pushpolygons', openjscad_polygons[i][1]);
          gameInstance.SendMessage('make_stl', 'pushpolygons', openjscad_polygons[i][2]);
          polystr += openjscad_polygons[i][0] + "," + openjscad_polygons[i][1] + "," + openjscad_polygons[i][2] + ",";
        }
        //console.log(polystr);
        gameInstance.SendMessage('make_stl', 'makepolygons');
        openjscad_polygons = null;
        openjscad_polygons = new Array();
      }

      /*
      let polygonstr = "";
      for (let i = 0; i < openjscad_polygons.length; i++) {
        polygonstr += openjscad_polygons[i];
      }
      polygonstr = polygonstr.slice(0, -1);
      gameInstance.SendMessage('make_stl', 'make_stl', polygonstr);
      */
    }

    var gameInstance = UnityLoader.instantiate("gameContainer", "Build/soy_simu_temp.json", { onProgress: UnityProgress });
    //gameInstance.SendMessage('make_stl', 'make_stl', 'MyString');
    //gameInstance.SendMessage('make_stl', 'make_stl', '30,30,2.01,30,-30,2.01,-30,-30,2.01,');
  </script>

</head>

<body onload="draw1('./soyimgs/ringo.png');" style="width: 100%;">
  <script>
    let syouyu_image;
    let syouyu_canvas;
    let img = new Image();    //画像オブジェクト作成

    function draw1(imgname) {
      img = new Image();
      img.src = imgname;  //写真のパスを指定する
      img.onload = function () {
        var ctx = document.getElementById("img_byouga").getContext("2d");
        ctx.clearRect(0, 0, 60, 60);
        ctx.drawImage(img, 0, 0, 60, 60);
        syouyu_canvas = document.getElementById("img_byouga").getContext("2d");
        syouyu_image = syouyu_canvas.getImageData(0, 0, 60, 60);
        document.getElementById("updateButton").click();
      }
    }
  </script>
  <script src="dist/min.js"></script>

  <h1>ITA Soy Sauce Dish</h1>
  <section class="step-select">
    <!-- inputはドラック＆ドロップ対応してるらしい -->
    <h2 class="step">
      1. 写真を選択
    </h2>
    <h3>サンプル</h3>
    <div class="image-examples">
      <button onclick="draw1('./soyimgs/duck.png')" imgname="duck"      ><img src="./soyimgs/duck.png" alt=""></button>
      <button onclick="draw1('./soyimgs/gradation.png')" imgname="gradation" ><img src="./soyimgs/gradation.png" alt=""></button>
      <button onclick="updateImage('kao_min')" imgname="kao_min"   ><img src="./soyimgs/kao_min.png" alt=""></button>
      <button onclick="updateImage('mikan')" imgname="mikan"     ><img src="./soyimgs/mikan.png" alt=""></button>
      <button onclick="updateImage('ringo')" imgname="ringo"     ><img src="./soyimgs/ringo.png" alt=""></button>
      <button onclick="updateImage('inu')" imgname="inu"       ><img src="./soyimgs/inu.png" alt=""></button>
    </div>
    <div class="select-photo-wrapper">
      <label class="select-photo" for="makesoyimg">
        <input type="file" id="makesoyimg" style="display:block;">
        <p class="plus">
          ここに画像を<br>ドラッグアンドドロップ
        </p>
      </label>
      <div class="use-image">
        <p>使用画像</p>
        <canvas id="img_byouga" width="60" height="60" style="width: 60px; height: 60px;"></canvas>
      </div>
    </div>
  </section>

  <!-- setup display of the errors as required by OpenJSCAD.js -->
  <section class="fix-params">
    <h2 class="step">
      2. パラメータ調整
    </h2>
    <div class="jscad-container">
      <div id="header">
        <div id="errordiv">hello</div>
      </div>
      <div class="preview">
        <!-- setup display of the viewer, i.e. canvas -->
        <div oncontextmenu="return false;" id="viewerContext" design-url="syouyuzara.jscad"></div>
        <!-- setup display of the status, as required by OpenJSCAD.js -->
        <!-- set display: block to display this -->
        <div id="tail" style="display: none;">
          <div id="statusdiv"></div>
        </div>
      </div>
    </div>
  </section>

  <section class="webgl-content">
    <h2 class="step">
      プレビュー
    </h2>
    <div id="gameContainer" style="width: 960px; height: 600px"></div>
    <div class="footer">
      <div class="webgl-logo"></div>
      <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>
      <div class="title">soy_simu</div>
    </div>
  </div>
  <section>
</body>

</html>
